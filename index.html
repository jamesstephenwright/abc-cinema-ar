<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ABC Cinema AR - Accessibility Mode</title>
    
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
      /* --- ACCESSIBILITY ICONS & UI --- */
      
      #ui-container {
        position: absolute;
        bottom: 20px;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 30px;
        z-index: 1000;
        pointer-events: auto;
      }

      /* Button Styles */
      .icon-btn {
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid white;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        padding: 10px;
      }

      .icon-btn.active {
        background: #FFFF00; /* High Vis Yellow */
        border-color: black;
        transform: scale(1.1);
      }

      .icon-btn svg {
        fill: white;
        width: 100%;
        height: 100%;
      }
      .icon-btn.active svg {
        fill: black;
      }

      /* --- TELEPROMPTER STYLES --- */
      #caption-container {
        position: absolute;
        top: 20px; /* MOVED TO TOP */
        left: 50%;
        transform: translateX(-50%);
        width: 85%;
        height: 150px; 
        background-color: rgba(0, 0, 0, 0.85);
        border: 2px solid #FFFF00;
        border-radius: 10px;
        overflow: hidden; 
        display: none;
        z-index: 999;
      }

      #caption-content {
        padding: 20px;
        color: #FFFF00;
        font-family: Arial, sans-serif;
        font-size: 1.4rem;
        line-height: 1.6;
        font-weight: bold;
        text-align: left;
        position: relative;
        top: 0;
      }
      
      #scroll-hint {
        position: absolute;
        bottom: 5px;
        right: 10px;
        font-size: 10px;
        color: #aaa;
        pointer-events: none;
      }
    </style>
  </head>
  <body>

    <audio id="audio-desc" src="./assets/lorem_ipsum.mp3"></audio>

    <div id="caption-container">
      <div id="caption-content">
        You are standing on a paved street corner looking at a large, vibrant mural painted on the construction hoardings of the ABC Cinema.

Above the artwork, a dark panel runs the length of the building, featuring the word SAVOY in elegant, gold Art Deco lettering, flanked by geometric fan motifs that shimmer in the light.

The mural below transports us to a stylized 1930s scene. On the far left, a fashionable couple strolls past; the woman wears a floor length teal dress with yellow flowers and a cloche hat, walking a sleek white greyhound dog. Beside her, a man in a sharp dark suit and fedora looks on. Above them, a vintage biplane soars through a sky of teal and blue curves.

Moving to the centre, a classic maroon saloon car with white walled tyres sits parked in the foreground. Behind it rises a stylized cityscape of jagged skyscrapers in bold shades of orange, lime green, and gold. To the right of the car, other figures in period dress, men in tuxedos and women in flapper style coats, mingle against the backdrop of this nostalgic Jazz Age city.
        
      </div>
      <div id="scroll-hint">Hold to Pause â€¢ Swipe Up/Down to Scroll</div>
    </div>

    <div id="ui-container">
      
      <button id="btn-captions" class="icon-btn" aria-label="Toggle Captions">
        <svg viewBox="0 0 24 24">
           <path d="M19 4H5C3.89 4 3 4.9 3 6V18C3 19.1 3.89 20 5 20H19C20.1 20 21 19.1 21 18V6C21 4.9 20.1 4 19 4M11 11H9.5V10.5H8.5V13.5H9.5V13H11V14.5C11 15.33 10.33 16 9.5 16H8C7.17 16 6.5 15.33 6.5 14.5V9.5C6.5 8.67 7.17 8 8 8H9.5C10.33 8 11 8.67 11 9.5V11M17.5 11H16V10.5H15V13.5H16V13H17.5V14.5C17.5 15.33 16.83 16 16 16H14.5C13.67 16 13 15.33 13 14.5V9.5C13 8.67 13.67 8 14.5 8H16C16.83 8 17.5 8.67 17.5 9.5V11Z" />
        </svg>
      </button>

      <button id="btn-audio" class="icon-btn" aria-label="Toggle Audio Description">
        <svg viewBox="0 0 24 24">
           <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M4.5,10.5V8.5H6.5V10.5H4.5M4.5,15.5V13.5H6.5V15.5H4.5M15,14A1,1 0 0,1 14,15H10A1,1 0 0,1 9,14V10A1,1 0 0,1 10,9H14A1,1 0 0,1 15,10V14M17.5,15.5V13.5H19.5V15.5H17.5M17.5,10.5V8.5H19.5V10.5H17.5M13.5,13.5H10.5V10.5H13.5V13.5Z" />
        </svg>
      </button>

    </div>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      <a-entity mindar-image-target="targetIndex: 0"></a-entity>
    </a-scene>

    <script>
      const btnCaptions = document.getElementById('btn-captions');
      const btnAudio = document.getElementById('btn-audio');
      const captionContainer = document.getElementById('caption-container');
      const captionContent = document.getElementById('caption-content');
      const audioEl = document.getElementById('audio-desc');

      // Audio Logic
      btnAudio.addEventListener('click', () => {
        btnAudio.classList.toggle('active');
        if (audioEl.paused) {
          audioEl.play();
        } else {
          audioEl.pause();
          audioEl.currentTime = 0;
        }
      });

      // --- SCROLLING LOGIC ---
      let scrollInterval;
      let currentTop = 0;
      let isPaused = false;
      let scrollSpeed = 0.4;
      
      // Touch Variables
      let touchStartY = 0; // Changed to Y
      let isTouching = false;

      // 1. Toggle Button
      btnCaptions.addEventListener('click', () => {
        btnCaptions.classList.toggle('active');
        if (captionContainer.style.display === 'block') {
          stopScrolling();
          captionContainer.style.display = 'none';
        } else {
          captionContainer.style.display = 'block';
          startScrolling();
        }
      });

      // 2. Auto-Scroll
      function startScrolling() {
        if (scrollInterval) cancelAnimationFrame(scrollInterval);
        
        function animate() {
          if (!isPaused && captionContainer.style.display === 'block') {
            currentTop -= scrollSpeed; // Automatically moves up
            
            // Limit Bounds
            const maxScroll = -(captionContent.clientHeight - captionContainer.clientHeight);
            if (currentTop < maxScroll) currentTop = maxScroll; 
            if (currentTop > 0) currentTop = 0;

            captionContent.style.top = currentTop + 'px';
          }
          scrollInterval = requestAnimationFrame(animate);
        }
        animate();
      }

      function stopScrolling() {
        cancelAnimationFrame(scrollInterval);
      }

      // 3. Vertical Swipe Interactions
      captionContainer.addEventListener('touchstart', (e) => {
        isPaused = true; 
        touchStartY = e.touches[0].clientY; // Capture Vertical Start
        isTouching = true;
      });

      captionContainer.addEventListener('touchend', () => {
        isPaused = false;
        isTouching = false;
      });

      captionContainer.addEventListener('touchmove', (e) => {
        if (!isTouching) return;
        e.preventDefault(); 
        
        const touchCurrentY = e.touches[0].clientY; // Capture Vertical Current
        const diffY = touchCurrentY - touchStartY;  // Calculate vertical difference

        // LOGIC:
        // Drag Down (Positive diffY) -> Add to Top -> Text moves Down (Rewind)
        // Drag Up (Negative diffY) -> Subtract from Top -> Text moves Up (Forward)
        
        const sensitivity = 2.0; 
        currentTop += (diffY * 0.05) * sensitivity;

        // Apply visual update immediately
        captionContent.style.top = currentTop + 'px';
      });

    </script>
  </body>
</html>
