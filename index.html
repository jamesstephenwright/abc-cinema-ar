<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ABC Cinema AR - Accessibility Mode</title>
    
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
      /* --- BOTTOM UI (CC & AUDIO) --- */
      #ui-container {
        position: absolute;
        bottom: 20px;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 30px;
        z-index: 1000;
        pointer-events: auto;
      }

      /* --- TOP RIGHT UI (FONT CONTROLS) --- */
      #font-controls {
        position: absolute;
        top: 20px;
        right: 10px;
        display: none; /* Hidden by default, appears with Captions */
        flex-direction: column; /* Stack Vertically */
        gap: 10px;
        z-index: 1001;
      }

      /* Shared Button Styles */
      .icon-btn {
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid white;
        border-radius: 50%;
        width: 55px; 
        height: 55px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        padding: 10px;
      }

      /* Active State (Yellow) */
      .icon-btn.active {
        background: #FFFF00; 
        border-color: black;
        transform: scale(1.1);
      }

      .icon-btn svg {
        fill: white;
        width: 100%;
        height: 100%;
      }
      .icon-btn.active svg {
        fill: black;
      }
      
      /* Specific style for Font Buttons (Click effect only) */
      .font-btn:active {
        background: white;
      }
      .font-btn:active svg {
        fill: black;
      }

      /* --- TELEPROMPTER STYLES --- */
      #caption-container {
        position: absolute;
        top: 20px; 
        left: 50%; /* Center of screen */
        transform: translateX(-50%); /* Center alignment fix */
        
        /* Adjusted width to leave room for buttons on the right */
        width: 75%; 
        
        height: 150px; 
        background-color: rgba(0, 0, 0, 0.85);
        border: 2px solid #FFFFFF; 
        border-radius: 10px;
        overflow: hidden; 
        display: none;
        z-index: 999;
      }

      #caption-content {
        padding: 20px;
        color: #FFFFFF; 
        font-family: Arial, sans-serif;
        font-size: 1.4rem; 
        line-height: 1.4;
        font-weight: bold;
        text-align: left;
        position: relative;
        top: 0;
      }
      
      #scroll-hint {
        position: absolute;
        bottom: 5px;
        right: 10px;
        font-size: 10px;
        color: #aaa;
        pointer-events: none;
      }
    </style>
  </head>
  <body>

    <audio id="audio-desc" src="./assets/audio_description.mp3"></audio>

    <div id="caption-container">
      <div id="caption-content">
        You are standing on a paved street corner looking at a large, vibrant mural painted on the construction hoardings of the ABC Cinema.
        Above the artwork, a dark panel runs the length of the building, featuring the word SAVOY in elegant, gold Art Deco lettering.
        The mural below transports us to a stylized 1930s scene. On the far left, a fashionable couple strolls past; the woman wears a floor length teal dress with yellow flowers.
        Moving to the centre, a classic maroon saloon car with white walled tyres sits parked in the foreground.
        (Swipe Down to Rewind, Swipe Up to Forward)
      </div>
      <div id="scroll-hint">Hold to Pause â€¢ Swipe Up/Down to Scroll</div>
    </div>

    <div id="font-controls">
      <button id="btn-font-up" class="icon-btn font-btn" aria-label="Increase Font Size">
        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg> 
      </button>
      
      <button id="btn-font-down" class="icon-btn font-btn" aria-label="Decrease Font Size">
        <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"/></svg> 
      </button>
    </div>

    <div id="ui-container">
      
      <button id="btn-captions" class="icon-btn" aria-label="Toggle Captions">
        <svg viewBox="0 0 24 24">
           <path d="M19 4H5C3.89 4 3 4.9 3 6V18C3 19.1 3.89 20 5 20H19C20.1 20 21 19.1 21 18V6C21 4.9 20.1 4 19 4M11 11H9.5V10.5H8.5V13.5H9.5V13H11V14.5C11 15.33 10.33 16 9.5 16H8C7.17 16 6.5 15.33 6.5 14.5V9.5C6.5 8.67 7.17 8 8 8H9.5C10.33 8 11 8.67 11 9.5V11M17.5 11H16V10.5H15V13.5H16V13H17.5V14.5C17.5 15.33 16.83 16 16 16H14.5C13.67 16 13 15.33 13 14.5V9.5C13 8.67 13.67 8 14.5 8H16C16.83 8 17.5 8.67 17.5 9.5V11Z" />
        </svg>
      </button>

      <button id="btn-audio" class="icon-btn" aria-label="Toggle Audio Description">
        <svg viewBox="0 0 24 24">
           <path d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M4.5,10.5V8.5H6.5V10.5H4.5M4.5,15.5V13.5H6.5V15.5H4.5M15,14A1,1 0 0,1 14,15H10A1,1 0 0,1 9,14V10A1,1 0 0,1 10,9H14A1,1 0 0,1 15,10V14M17.5,15.5V13.5H19.5V15.5H17.5M17.5,10.5V8.5H19.5V10.5H17.5M13.5,13.5H10.5V10.5H13.5V13.5Z" />
        </svg>
      </button>

    </div>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
      <a-entity mindar-image-target="targetIndex: 0"></a-entity>
    </a-scene>

    <script>
      // Elements
      const btnCaptions = document.getElementById('btn-captions');
      const btnAudio = document.getElementById('btn-audio');
      
      // Font Elements
      const fontControls = document.getElementById('font-controls');
      const btnFontUp = document.getElementById('btn-font-up');
      const btnFontDown = document.getElementById('btn-font-down');

      const captionContainer = document.getElementById('caption-container');
      const captionContent = document.getElementById('caption-content');
      const audioEl = document.getElementById('audio-desc');
      
      // Settings
      let scrollSpeed = 0.25; 
      let currentFontSize = 1.4; 

      let scrollInterval;
      let currentTop = 0;
      let isPaused = false;
      let touchStartY = 0;
      let isTouching = false;

      // --- HELPER: RESET & SYNC ---
      function resetSync() {
        audioEl.currentTime = 0;
        currentTop = 0;
        captionContent.style.top = '0px';
      }
      
      // --- FONT SIZE LOGIC ---
      function updateFontSize() {
        captionContent.style.fontSize = currentFontSize + 'rem';
      }

      btnFontUp.addEventListener('click', () => {
        if (currentFontSize < 3.0) { 
          currentFontSize += 0.2;
          updateFontSize();
        }
      });

      btnFontDown.addEventListener('click', () => {
        if (currentFontSize > 1.0) { 
          currentFontSize -= 0.2;
          updateFontSize();
        }
      });

      // --- 1. CAPTION BUTTON LOGIC ---
      btnCaptions.addEventListener('click', () => {
        btnCaptions.classList.toggle('active');
        
        if (captionContainer.style.display === 'block') {
          // Turn OFF
          stopScrolling();
          captionContainer.style.display = 'none';
          fontControls.style.display = 'none'; // Hide font buttons
        } else {
          // Turn ON
          captionContainer.style.display = 'block';
          fontControls.style.display = 'flex'; // Show font buttons
          
          if (btnAudio.classList.contains('active')) {
            resetSync();
            audioEl.play(); 
          }
          startScrolling();
        }
      });

      // --- 2. AUDIO BUTTON LOGIC ---
      btnAudio.addEventListener('click', () => {
        btnAudio.classList.toggle('active');
        
        if (audioEl.paused) {
          if (btnCaptions.classList.contains('active')) {
            resetSync();
          }
          audioEl.play();
        } else {
          audioEl.pause();
        }
      });

      // --- SCROLLING ANIMATION ---
      function startScrolling() {
        if (scrollInterval) cancelAnimationFrame(scrollInterval);
        
        function animate() {
          if (!isPaused && captionContainer.style.display === 'block') {
            currentTop -= scrollSpeed;
            
            const maxScroll = -(captionContent.clientHeight - captionContainer.clientHeight);
            if (currentTop < maxScroll) currentTop = maxScroll; 
            if (currentTop > 0) currentTop = 0;

            captionContent.style.top = currentTop + 'px';
          }
          scrollInterval = requestAnimationFrame(animate);
        }
        animate();
      }

      function stopScrolling() {
        cancelAnimationFrame(scrollInterval);
      }

      // --- TOUCH INTERACTIONS ---
      captionContainer.addEventListener('touchstart', (e) => {
        isPaused = true; 
        touchStartY = e.touches[0].clientY;
        isTouching = true;
      });

      captionContainer.addEventListener('touchend', () => {
        isPaused = false;
        isTouching = false;
      });

      captionContainer.addEventListener('touchmove', (e) => {
        if (!isTouching) return;
        e.preventDefault(); 
        
        const touchCurrentY = e.touches[0].clientY;
        const diffY = touchCurrentY - touchStartY;

        const sensitivity = 2.0; 
        currentTop += (diffY * 0.05) * sensitivity;

        captionContent.style.top = currentTop + 'px';
      });

    </script>
  </body>
</html>
